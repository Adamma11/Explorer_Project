const nodemailer = require('nodemailer');
const path  = require("path");

// exports.emailCandidateDataOfACheck = async function(req,res,next){
//     try{
//         const {toEmail,subject,body} = req.body;
//         let transporter = nodemailer.createTransport({
//             host: "smtp.office365.com",
//             port: 587,
//             secure: false,
//             auth: {
//                 user: "welcome.vibe@verifacts.co.in",
//                 //user: "arun.kumar@verifacts.co.in",
//                 //pass: "T}b6qgsp8caAae2"
//                 pass: "Xos71270"
//             }
//         })
//         let mailOptions = {
//             from: "welcome.vibe@verifacts.co.in",
//             to: toEmail,
//             subject: subject,
//             text: "Dear " + req.body.toEmail + ",\n\n" + "Welcome to Vibe!\n\n" + "Your account has been created. You can now login using the following credentials.\n\n" + "URL:https://vibe.verifacts.co.in\n" + "Please change the password immediately after the first login.\n\n" + "Need any help with the account?" + "Write to support.vibe@verifacts.co.in\n\n" + "This is autogenerated email, please do not respond.\n\n" + "Thank you,\n" + "Team Verifacts"
//         }
//         transporter.sendMail(mailOptions, function (error, info) {
//             if (error) {
//                 console.log(error);
//                 res.status(500).json({ message: error.message || "Some error occured while saving user password" })
//             } else {
//                 res.status(200).json({ message: "Password generated successfully" });
//             }
//         })

//     }catch(error){
//         return res.status(500).send({message:"Unexpected error occured. Please try again."})
//     }
// }



/*exports.emailCandidateDataOfACheck = async function(req,res,next){
    try{
        const {toEmail,subject,body} = req.body;
        console.log(body);
        let transporter = nodemailer.createTransport({
            host: "smtp.office365.com",
            port: 587,
            secure: false,
            auth: {
                user: "info@adamma.in",
                //user: "arun.kumar@verifacts.co.in",
                //pass: "T}b6qgsp8caAae2"
               pass: "Adamma@123"
            }
        })
        let mailOptions = {
            from: "info@adamma.in",
            to: toEmail,
            subject: subject,
            html: body
        }
        transporter.sendMail(mailOptions, function (error, info) {
            if (error) {
                console.log(error);
                res.status(500).json({ message: error.message || "Some error occured while sending email" })
            } else {
                res.status(200).json({ message: "Email sent successfully" });
            }
        })

    }catch(error){
        return res.status(500).send({message:"Unexpected error occured. Please try again."})
    }
}*/
/*exports.emailCandidateDataOfACheck = async function(req,res,next){
    try{
        const {toEmail,subject,body,cc,caseId,componentDocId,componentName,filenames} = req.body;

        const attachments=[];

        for(let filename of filenames){
            let filePath = '/REPO_STORAGE/case_uploads/' + caseId + '/' + componentName + '/' + componentDocId + '/candidatedocs/' + filename + '.pdf';

            let attachment={filename:filename+".pdf",path:filePath};
            attachments.push(attachment);

        }
        let transporter = nodemailer.createTransport({
            host: "smtp.office365.com",
            port: 587,
            secure: false,
            auth: {
                user: "info@adamma.in",
                //user: "arun.kumar@verifacts.co.in",
                //pass: "T}b6qgsp8caAae2"
                pass: "Adamma@123"
            }
        })
        let mailOptions = {
            from: "info@adamma.in",
            to: toEmail,
            cc:cc,
            subject: subject,
            html: body,
            attachments:attachments.length? attachments : []
        }
        transporter.sendMail(mailOptions, function (error, info) {
            if (error) {
                console.log(error);
                res.status(500).json({ message: error.message || "Some error occured while sending email" })
            } else {
                res.status(200).json({ message: "Email sent successfully" });
            }
        })

    }catch(error){
        return res.status(500).send({message:"Unexpected error occured. Please try again."})
    }
}*/
//////////////////////////new 26Oct2023//////////
exports.emailCandidateDataOfACheck = async function(req,res,next){
    try{
        const {toEmail,subject,body,cc,caseId,componentDocId,componentName,filenames} = req.body;

        const attachments=[];

        for(let filename of filenames){
            let filePath = '/REPO_STORAGE/case_uploads/' + caseId + '/' + componentName + '/' + componentDocId + '/candidatedocs/' + filename + '.pdf';

            let attachment={filename:filename+".pdf",path:filePath};
            attachments.push(attachment);

        }
        let transporter = nodemailer.createTransport({
            host: "smtp.office365.com",
            port: 587,
            secure: false,
            auth: {
                user: "info@adamma.in",
                //user: "arun.kumar@verifacts.co.in",
                //pass: "T}b6qgsp8caAae2"
                pass: "Adamma@123"
            }
        })
        let mailOptions = {
            from: "info@adamma.in",
            to: toEmail,
            cc:cc,
            subject: subject,
            html: body,
            attachments:attachments.length? attachments : []
        }
        transporter.sendMail(mailOptions, function (error, info) {
            if (error) {
                console.log(error);
                res.status(500).json({ message: error.message || "Some error occured while sending email" })
            } else {
                res.status(200).json({ message: "Email sent successfully" });
            }
        })

    }catch(error){
        return res.status(500).send({message:"Unexpected error occured. Please try again."})
    }
}
